# spec/modules/exploits/grafana/grafana_sql_injection_spec.rb
require 'rspec'
require 'spec_helper'
require 'msf/core'
require_relative '../../../../modules/exploits/grafana/grafana_sql_injection'

RSpec.describe MetasploitModule do
  it 'should load' do
    expect { described_class.new }.not_to raise_error
  end

  context 'when targeting a vulnerable server' do
    let(:module_instance) { described_class.new }

    it 'should check if the target is vulnerable' do
      allow(module_instance).to receive(:send_request_cgi).and_return(
        double('response', code: 200, body: 'vulnerable_string')
      )
      expect(module_instance.check).to eq(Msf::Exploit::CheckCode::Vulnerable)
    end

    it 'should exploit the vulnerability' do
      allow(module_instance).to receive(:send_request_cgi).and_return(
        double('response', code: 200, body: 'Payload executed')
      )
      expect { module_instance.exploit }.not_to raise_error
    end
  end
end

